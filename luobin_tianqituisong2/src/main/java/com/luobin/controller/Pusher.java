package com.luobin.controller;import com.fasterxml.jackson.core.JsonProcessingException;import com.luobin.pojo.Weather;import com.luobin.utils.*;import lombok.extern.slf4j.Slf4j;import me.chanjar.weixin.mp.api.WxMpInMemoryConfigStorage;import me.chanjar.weixin.mp.api.WxMpService;import me.chanjar.weixin.mp.api.impl.WxMpServiceImpl;import me.chanjar.weixin.mp.bean.template.WxMpTemplateData;import me.chanjar.weixin.mp.bean.template.WxMpTemplateMessage;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.stereotype.Component;import java.util.regex.Matcher;import java.util.regex.Pattern;@Slf4j@Component@SpringBootTestpublic class Pusher {    /**     * 测试公众号的 id     */    private static String appId;    /**     * 测试公众号的 密钥     */    private static String secret;    /**     * 对方微信id     */    private static String user;    /**     * 消息模板id     */    private static String templateId;    @Value("${com.secret}")    public void setSecret(String secret) {Pusher.secret= secret;}    @Value("${com.user}")    public void setUser(String user) {Pusher.user= user;}    @Value("${com.templateId}")    public void setTemplateId(String templateId) {Pusher.templateId= templateId;}    @Value("${com.appId}")    public void setAppId(String appId) {Pusher.appId= appId;}    @Test    void contextLoads() {        push();    }    public static void push(){        //1，配置        WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();        wxStorage.setAppId(appId);        wxStorage.setSecret(secret);        WxMpService wxMpService = new WxMpServiceImpl();        wxMpService.setWxMpConfigStorage(wxStorage);        // 推送消息        WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder()                .toUser(user) // 对方微信                .templateId(templateId) // 消息模板                .build();        // 配置你的信息        Weather weather = new Weather();        try {            weather = WeatherUtils.getWeather();        } catch (JsonProcessingException e) {            log.error("获取天气失败");            e.printStackTrace();        }        int birthday_jo = JiNianRiUtils.getBirthday_Jo(); // 计算 生日倒计时        int lianAi = JiNianRiUtils.getLianAi(); // 计算 相恋天数        String fengli = weather.getForecast().get(0).getFengli();        Matcher compile = Pattern.compile(".*<!\\[CDATA\\[(.*)级\\]\\]>.*").matcher(fengli);        compile.matches();        Integer fengliI = Integer.valueOf(compile.group(1));        Matcher fengliN = Pattern.compile(".*<!\\[CDATA\\[(.*)\\]\\]>.*").matcher(fengli);        fengliN.matches();        String fengliNa = String.valueOf(fengliN.group(1));        String fengliName = null; String fengliColour = null;        if (fengliI == 0){            fengliName = "无风"; fengliColour = "#99FF00";        } else if (fengliI < 3) {            fengliName = "轻风"; fengliColour = "#99FF00";        } else if (fengliI == 3) {            fengliName = "微风"; fengliColour = "#99FF00";        } else if (fengliI == 4) {            fengliName = "和风"; fengliColour = "#FFFF99";        } else if (fengliI == 5) {            fengliName = "清风"; fengliColour = "#FFFF00";        } else if (fengliI == 6) {            fengliName = "强风"; fengliColour = "#FF9933";        } else if (fengliI == 7) {            fengliName = "劲风+"; fengliColour = "#FF3300";        } else if (fengliI > 7) {            fengliName = "大风+"; fengliColour = "#990000";        }        templateMessage.addData(new WxMpTemplateData("riqi", weather.getForecast().get(0).getDate(), "#00BFFF")); // 日期        templateMessage.addData(new WxMpTemplateData("tianqi", weather.getForecast().get(0).getType(),"#00FFFF")); // 天气        templateMessage.addData(new WxMpTemplateData("ganmao", weather.getGanmao(), RandomColor.randomColour())); // 感冒情况        templateMessage.addData(new WxMpTemplateData("city", weather.getCity(), "#000000")); // 地区        templateMessage.addData(new WxMpTemplateData("wendu", weather.getWendu()+"℃","#000000")); // 当前温度        templateMessage.addData(new WxMpTemplateData("fengli", fengliName+"("+fengliNa+")", fengliColour)); // 风量        templateMessage.addData(new WxMpTemplateData("low",weather.getForecast().get(0).getLow() + "","#173177")); // 最低气温        templateMessage.addData(new WxMpTemplateData("high",weather.getForecast().get(0).getHigh()+ "","#FF6347" )); // 最高气温        templateMessage.addData(new WxMpTemplateData("caihongpi", CaiHongPiUtils.getCaiHongPi(),"#FF69B4")); // 彩虹屁        templateMessage.addData(new WxMpTemplateData("lianai", lianAi +"","#FF1493")); // 相恋天数        templateMessage.addData(new WxMpTemplateData("shengri",birthday_jo + "","#FFA500")); //生日倒计时        templateMessage.addData(new WxMpTemplateData("meme", MemeUtils.randomMeme())); //颜文字        String beizhu = "";        if(lianAi % 365 == 0){ beizhu += "❤今天是恋爱" + (lianAi / 365) + "周年纪念日！"; }        if(lianAi % 100 == 0){ beizhu += "❤今天是恋爱" + lianAi + "天纪念日！"; }        if(lianAi == 1314){ beizhu += "❤今天是恋爱" + lianAi + "天纪念日！"; }        if(birthday_jo == 0){ beizhu += "❤今天是生日，生日快乐呀！"; }        templateMessage.addData(new WxMpTemplateData("beizhu", beizhu, "#FF0000"));        try {            log.info(templateMessage.toJson());            log.info(wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage));        } catch (Exception e) {            log.error("推送失败：" + e.getMessage());            e.printStackTrace();        }    }}